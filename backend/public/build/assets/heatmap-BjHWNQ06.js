document.addEventListener("DOMContentLoaded",function(){let n;const r=filterResults;function d(i){return Object.entries(i).map(([t,a])=>{const e=parseFloat(a.latitude),l=parseFloat(a.longitude),o=parseInt(a.total_patient_count)||1;return isNaN(e)||isNaN(l)?(console.warn("Skipping record due to invalid coordinates:",a),null):[e,l,o]}).filter(t=>t!==null)}n=L.map("heatmap").setView([10.3157,123.8854],12),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',maxZoom:18}).addTo(n);let c=d(r);Object.entries(r).forEach(([i,t])=>{const a=parseInt(t.total_patient_count)||0;let e="#4CAF50";a>400?e="#F44336":a>250?e="#FF9800":a>100&&(e="#FFC107"),L.circle([t.latitude,t.longitude],{radius:100,color:"none",fillColor:e,fillOpacity:.5,interactive:!1}).addTo(n);const l=L.circleMarker([t.latitude,t.longitude],{radius:5,color:e,fillColor:e,fillOpacity:1,weight:1}).addTo(n);let o=`<div style="font-size:14px; line-height:1.4;">
                <b>ğŸ“${t.name}</b><br>
                `;t.diseases.forEach(s=>{o+=`<small class="text-green-700">- ${s.name}(ğŸ‘¥${s.patient_count})</small><br/>`}),o+="</div>",l.bindPopup(o)}),n.fitBounds(L.latLngBounds(c)),window.addEventListener("heatmapDataUpdated",function(i){const t=i.detail;console.log("Heatmap updated with data:",t)})});
